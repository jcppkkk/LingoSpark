# ESLint 自動修正（先修正可自動修復的問題）
echo "🔍 自動修正 ESLint 問題..."
npm run lint:fix

# ESLint 檢查（檢查是否還有無法自動修正的錯誤）
echo "🔍 檢查 ESLint 錯誤..."
npm run lint

# 如果 ESLint 檢查失敗，阻止提交
if [ $? -ne 0 ]; then
  echo ""
  echo "❌ 提交被阻止：發現 ESLint 錯誤"
  echo "💡 提示：執行 npm run lint:fix 自動修正部分問題"
  exit 1
fi

# TypeScript 語法檢查（在 ESLint 修正後檢查類型錯誤）
echo "🔍 檢查 TypeScript 語法錯誤..."
npm run type-check

# 如果語法檢查失敗，阻止提交
if [ $? -ne 0 ]; then
  echo ""
  echo "❌ 提交被阻止：發現 TypeScript 語法錯誤"
  echo "💡 提示：請修復所有語法錯誤後再提交"
  exit 1
fi

# 工作流程檢查
echo "🔍 檢查工作流程規則..."
npm run workflow:check

# 如果工作流程檢查失敗，阻止提交
if [ $? -ne 0 ]; then
  echo ""
  echo "❌ 提交被阻止：工作流程規則檢查失敗"
  echo "💡 提示："
  echo "   1. 新增組件必須添加 @ARCH 註解並更新 docs/features.md"
  echo "   2. 新增服務必須更新 ARCHITECTURE.md"
  echo "   3. 執行 npm run doc:update <檔案路徑> 獲取更新建議"
  echo "   參考：docs/architecture/workflow.md"
  exit 1
fi

# ARCHITECTURE 註解驗證
echo "🔍 檢查 ARCHITECTURE 註解..."
npm run arch:validate

# 如果驗證失敗，阻止提交
if [ $? -ne 0 ]; then
  echo ""
  echo "❌ 提交被阻止：請修復 ARCHITECTURE 註解問題"
  echo "💡 提示：使用 --no-verify 可以跳過檢查（不建議）"
  exit 1
fi

# 基礎架構檢查（可選，僅警告）
echo "🔍 檢查架構文檔同步狀態..."
npm run check-architecture:enhanced || true

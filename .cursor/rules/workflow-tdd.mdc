---
alwaysApply: false
description: TDD 工作流程規則 - Feature -> UX -> 測試 -> 實作的完整循環
applicableFiles:
  - "docs/features/**/*.md"
  - "tests/ux/**/*.test.tsx"
  - "components/**/*.tsx"
  - "services/**/*.ts"
---

# TDD 工作流程規則

本文檔定義完整的 TDD（Test-Driven Development）工作流程，確保從功能定義到實作的完整循環。

> **相關規則**：
>
> - 開發階段：`workflow-development.mdc`
> - 測試實作：`workflow-testing.mdc`
> - 文檔更新：`workflow-documentation.mdc`

## TDD 工作流程概述

完整的 TDD 循環包含四個階段：

```
Feature 定義 → UX 設計 → 測試設計 → 實作
     ↑                                              ↓
     └──────────────────────────────────────────────┘
```

**核心原則**：

1. **Feature -> UX**：UX 設計必須符合 feature 的一般性期望（業界標準、使用者需求）
2. **UX -> 測試**：測試預期目標必須完全符合 UX 定義
3. **測試 -> 實作**：實作必須通過所有測試，並符合 UX 定義
4. **實作 -> Feature**：實作完成後驗證是否符合原始 feature 期望

## 階段 1: Feature 定義

### 規則 1.1: Feature 定義階段

**在開始任何開發前，必須明確定義功能**：

#### 1.1.1: 功能範圍和目標

**必須明確**：

- **功能描述**：簡潔描述功能用途和價值
- **目標使用者**：誰會使用這個功能
- **使用場景**：在什麼情況下使用
- **核心價值**：這個功能解決什麼問題

#### 1.1.2: 識別功能的一般性期望

**必須識別**：

- **業界標準**：類似功能的常見做法
- **使用者需求**：目標使用者的期望
- **技術限制**：技術實現的限制
- **設計原則**：符合專案設計原則

**範例**：

```markdown
## 功能介紹

字庫管理與製作新卡片功能模組提供了完整的單字管理體驗。

**一般性期望**：

- 使用者可以快速搜尋和篩選單字（符合常見的資料管理工具標準）
- 新增單字應該有即時反饋（符合現代 Web 應用的 UX 標準）
- 錯誤處理應該清晰明確（符合使用者體驗最佳實踐）
```

## 階段 2: UX 設計

### 規則 1.2: UX 設計階段

**基於 feature 定義設計 UX 路徑**：

#### 1.2.1: 確保 UX 符合 feature 的一般性期望

**檢查項目**：

- UX 設計是否涵蓋所有功能點？
- UX 設計是否符合業界標準？
- UX 設計是否符合使用者需求？
- UX 設計是否考慮技術限制？

#### 1.2.2: 定義完整的 UX 路徑

**每個 UX 路徑必須包含**：

- **觸發條件**：什麼情況下觸發這個 UX 路徑
- **操作步驟**：使用者需要執行哪些操作
- **預期結果**：每個步驟的預期結果

**範例**：

```markdown
### UX0011: 手動輸入單字

**觸發條件**：使用者在製作新卡片標籤頁

**操作步驟**：

1. 使用者在製作新卡片標籤頁
2. 在輸入框輸入英文單字或片語
3. 點擊「新增」按鈕或按 Enter 鍵
4. 單字加入待處理列表

**預期結果**：

- 輸入框可以輸入文字
- 點擊「新增」或按 Enter 後，單字加入待處理列表
- 輸入框清空，準備輸入下一個單字
- 如果單字已存在，顯示錯誤訊息
- 待處理列表顯示新加入的單字（狀態為「排隊中」）
```

#### 1.2.3: UX 路徑驗證

**在完成 UX 設計後，必須驗證**：

- 所有功能點都有對應的 UX 路徑
- 所有 UX 路徑都有明確的觸發條件、操作步驟、預期結果
- UX 設計符合 feature 的一般性期望

## 階段 3: 測試設計

### 規則 1.3: 測試設計階段

**基於 UX 定義編寫測試**：

#### 1.3.1: 測試必須完全符合 UX 定義

**測試必須驗證**：

- **觸發條件**：測試必須在正確的觸發條件下執行
- **操作步驟**：測試必須執行所有操作步驟
- **預期結果**：測試必須驗證所有預期結果

#### 1.3.2: 測試描述必須包含 UX 定義

**測試描述必須包含**：

- 觸發條件的說明
- 操作步驟的說明
- 預期結果的說明

**範例**：

```typescript
describe("UX0011: 手動輸入單字", () => {
  it("應該在輸入單字並提交後將單字加入待處理列表", async () => {
    // 觸發條件：使用者在製作新卡片標籤頁
    // 操作步驟：
    // 1. 使用者在製作新卡片標籤頁
    // 2. 在輸入框輸入英文單字或片語
    // 3. 點擊「新增」按鈕或按 Enter 鍵
    // 4. 單字加入待處理列表
    //
    // 預期結果：
    // - 輸入框可以輸入文字
    // - 點擊「新增」或按 Enter 後，單字加入待處理列表
    // - 輸入框清空，準備輸入下一個單字
    // - 如果單字已存在，顯示錯誤訊息
    // - 待處理列表顯示新加入的單字（狀態為「排隊中」）
    // 測試實作...
  });
});
```

#### 1.3.3: 測試與 UX 定義一致性檢查

**在完成測試設計後，必須檢查**：

- 測試是否驗證了所有預期結果？
- 測試是否執行了所有操作步驟？
- 測試觸發條件是否與 UX 定義一致？
- 測試描述是否與 UX 定義一致？

## 階段 4: 實作

### 規則 1.4: 實作階段

**基於測試編寫實作**：

#### 1.4.1: 實作必須通過所有測試

**實作必須**：

- 通過所有測試用例
- 符合測試的預期行為
- 處理所有邊界情況

#### 1.4.2: 實作必須符合 UX 定義

**實作必須**：

- 實現所有操作步驟
- 產生所有預期結果
- 符合 UX 定義的使用者體驗

#### 1.4.3: 實作驗證

**在完成實作後，必須驗證**：

- 所有測試通過
- 實作符合 UX 定義
- 實作符合 feature 的一般性期望

## 工作流程整合

### 規則 1.5: TDD 工作流程整合

**在開發新功能時，必須遵循以下順序**：

1. **Feature 定義**（規則 1.1）

   - 明確功能範圍和目標
   - 識別功能的一般性期望

2. **UX 設計**（規則 1.2）

   - 基於 feature 定義設計 UX 路徑
   - 確保 UX 符合 feature 的一般性期望
   - 定義觸發條件、操作步驟、預期結果

3. **測試設計**（規則 1.3）

   - 基於 UX 定義編寫測試
   - 測試必須完全符合 UX 定義
   - 測試描述必須包含觸發條件、操作步驟、預期結果

4. **實作**（規則 1.4）
   - 基於測試編寫實作
   - 確保實作通過所有測試
   - 確保實作符合 UX 定義

### 規則 1.6: 反向驗證

**在完成實作後，必須進行反向驗證**：

1. **實作 -> 測試**：實作是否通過所有測試？
2. **測試 -> UX**：測試是否完全符合 UX 定義？
3. **UX -> Feature**：UX 設計是否符合 feature 的一般性期望？

**如果發現不一致，必須調整**：

- 優先調整 UX 定義（如果不符合 feature 期望）
- 其次調整測試（如果不符合 UX 定義）
- 最後調整實作（如果不符合測試）

## 檢查工具

### 規則 1.7: 使用檢查工具

**在完成各階段後，必須使用檢查工具驗證**：

- **UX 定義與測試對應檢查**：`npm run tdd:check-ux-test`

  - 檢查測試是否完全符合 UX 定義
  - 檢查測試是否驗證了所有預期結果

- **Feature -> UX 合理性檢查**：`npm run tdd:check-feature-ux`

  - 檢查 UX 路徑是否涵蓋所有功能
  - 檢查 UX 設計是否符合 feature 的一般性期望

- **完整檢查**：`npm run tdd:check-all`
  - 執行所有 TDD 檢查

## 何時載入此規則

此規則在以下情況自動載入：

- 編輯 `docs/features/` 目錄下的檔案（UX 定義）
- 編輯 `tests/ux/` 目錄下的檔案（測試設計）
- 進行功能開發相關的對話
- 執行 TDD 檢查相關的命令

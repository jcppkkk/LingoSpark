---
alwaysApply: false
description: 文檔更新規則 - 功能文檔與架構文檔更新規範
applicableFiles:
  - "docs/**/*.md"
  - "ARCHITECTURE.md"
---

# 文檔更新規則

本文檔定義功能完成後文檔更新階段的規則。

> **相關規則**：
>
> - TDD 工作流程：`workflow-tdd.mdc`
> - 開發階段：`workflow-development.mdc`
> - 驗證提交：`workflow-verification.mdc`

## 階段 3: 完成功能並整併到 docs/features/

### 規則 3.1: 改寫或整併到 `docs/features/`

**當功能開發完成時**：

- 將 plan 中的內容改寫為功能文檔格式
- 整併到對應的 `docs/features/*.md` 文件中
- 記錄所有 @ARCH tags 的位置和 hash

### 規則 3.2: Plan 文件管理

#### 3.2.1: 優先執行項目管理

**在 plan 實作過程中，如果生成建議先執行的項目**（如修正測試失敗、修復關鍵 bug、驗證已完成功能等），**必須安排先列入到 plan md 中順序上優先執行之位置，並立即執行之**。

**處理流程**：

1. **識別優先項目**：在執行計劃過程中，如果發現需要優先處理的項目（如測試失敗、關鍵 bug、驗證需求等），應立即識別。

2. **調整計劃順序**：將優先項目移到計劃文件的優先位置（通常在"衍生目標"之後，"階段 1"之前，或作為"優先執行項目"段落）。

3. **立即執行**：優先項目應立即執行，完成後再繼續原計劃的後續階段。

**計劃文件結構**：

```markdown
# 計劃名稱

## 目標

[主要目標描述]

## 衍生目標

[當下不會完成的項目]

## 優先執行項目

以下項目需要優先處理，應在正式階段開始前完成：

- [ ] **優先項目 1** - [描述] - [原因]
- [ ] **優先項目 2** - [描述] - [原因]

## 階段 1: [階段名稱]

[實際要執行的階段內容]
```

**原則**：

- ✅ 優先項目應放在"衍生目標"之後，"階段 1"之前
- ✅ 優先項目應明確標註優先原因
- ✅ 優先項目應立即執行，不應延後
- ✅ 優先項目完成後，應更新計劃文件，標記為已完成
- ❌ 不要將優先項目混入一般執行階段中

#### 3.2.2: 處理已完成的 plan

**當 plan 中的所有項目都完成時，必須執行以下步驟**：

1. **整理結果到對應文檔**：

   - **功能相關**：更新或創建 `docs/features/*.md` 文件
   - **註解系統相關**：更新 `docs/annotations/*.md` 文件
   - **維護系統相關**：更新 `docs/maintenance/*.md` 文件
   - **架構相關**：更新 `ARCHITECTURE.md`

2. **移除已完成的 plan 文件**：
   - 刪除 `docs/plans/` 目錄下已完成的 plan 文件
   - 不要保留已完成計劃的歷史記錄（除非有特殊需求）

**重要**：

- ✅ 將所有實施結果整理到對應的文檔目錄
- ✅ 確保文檔完整且準確
- ✅ 移除已完成的 plan 文件（保持 plans 目錄只包含未完成的計劃）

### 規則 3.3: 非 Plan 類文件的寫作原則

**重要**：當將 plan 的實施結果整合到非 plan 類文件（如 `docs/annotations/*.md`、`docs/features/*.md`、`docs/maintenance/*.md` 等）時，必須遵循以下原則：

#### 原則 1: 描述最終完成狀態，而非階段規劃

❌ **錯誤**：在非 plan 類文件中描述階段規劃

```markdown
### 階段配置

#### Phase 1: 試點階段（已完成 ✅）

#### Phase 2: 擴展階段（已完成 ✅）

#### Phase 3: 全面推廣（進行中 🚀）
```

✅ **正確**：描述最終完成狀態

```markdown
### 當前配置狀態

系統已全面啟用註解檢查：

- **檢查範圍**：所有 `components/` 和 `services/` 目錄下的檔案
- **嚴格度**：error（所有變更都必須有註解，否則阻止提交）
```

#### 原則 2: 移除階段性描述，改為功能說明

❌ **錯誤**：描述推廣策略和階段

```markdown
## 漸進式推廣策略

系統採用三階段漸進式推廣策略：

1. Phase 1（試點階段）：...
2. Phase 2（擴展階段）：...
3. Phase 3（全面推廣）：...
```

✅ **正確**：描述系統狀態和功能

```markdown
## 系統狀態

### 系統功能

- ✅ Pre-commit hook 已配置並運作
- ✅ 格式錯誤檢查已啟用
- ✅ 所有組件變更都需要註解
```

#### 原則 3: 使用現在時態，描述當前運作方式

❌ **錯誤**：使用階段性描述

```markdown
系統目前處於 Phase 3（全面推廣）階段
```

✅ **正確**：使用現在時態描述當前狀態

```markdown
系統已全面啟用註解檢查
```

#### 檢查清單

在整合 plan 結果到非 plan 類文件時，確認：

- [ ] 已移除所有階段規劃描述（Phase 1、2、3 等）
- [ ] 已改為描述最終完成狀態
- [ ] 已移除「進行中」、「已完成」等階段性標記
- [ ] 已使用現在時態描述當前運作方式
- [ ] 已將「階段配置」改為「當前配置狀態」或「系統狀態」
- [ ] 已將「實施結果」改為「系統功能」或「功能說明」
- [ ] 已將「推廣策略」改為「系統運作方式」或「使用說明」

## 階段 4: 更新文檔

### 規則 4.1: 更新 `docs/features/README.md`

**觸發條件**：

- 新增組件或頁面
- 新增功能或修改現有功能
- UI/UX 變更
- 新增路由

**必須更新「功能列表」區段**：

```markdown
### 🆕 新功能名稱

**功能描述**：[簡潔描述功能用途]

**程式碼位置**：

- 組件：`components/NewFeature.tsx`
- 服務：`services/newService.ts`
  - `functionName()` - 功能描述

**UI 元素**：

- [UI] 元素名稱
  - 位置：`components/NewFeature.tsx:行號`
  - 功能：功能說明

**關鍵功能**：

- [FEAT] 功能名稱
  - 位置：`components/NewFeature.tsx:行號`
  - 功能：功能說明
```

**如適用，更新「常見任務與對應檔案」**：

```markdown
### 執行新功能相關任務

→ `components/NewFeature.tsx` + `services/newService.ts`
```

### 規則 4.2: 更新 `ARCHITECTURE.md`

**觸發條件**：

- 新增或修改服務
- 修改資料模型
- 新增路由或視圖
- 新增組件（更新應用程式流程）

**新增服務時**：在「服務層架構」區段新增

```markdown
### 新服務名稱 (Service Name)

**檔案**：`services/newService.ts`

**功能**：

- `functionName()` - 功能描述
```

**修改資料模型時**：在「資料模型」區段更新

````markdown
### NewType

```typescript
{
  field: type;
  // ...
}
```
````

**新增路由時**：更新「路由與視圖」和「應用程式流程」

### 規則 4.3: 文檔更新對應表

| 變更類型     | @ARCH 註解 | docs/features/README.md | ARCHITECTURE.md | 檢查命令             |
| ------------ | ---------- | ----------------------- | --------------- | -------------------- |
| 新增組件     | ✅ 必須    | ✅ 功能列表             | ✅ 應用程式流程 | `workflow:check`     |
| 新增服務     | ❌         | ✅ 程式碼位置           | ✅ 服務層架構   | `workflow:check`     |
| 修改資料模型 | ❌         | ❌                      | ✅ 資料模型     | `workflow:check`     |
| UI 變更      | ✅ 必須    | ✅ UI 元素              | ❌              | `arch:validate`      |
| UX 變更      | ✅ 必須    | ✅ 關鍵功能             | ❌              | `arch:validate`      |
| 新增路由     | ❌         | ✅ 路由與視圖           | ✅ 路由與視圖   | `check-architecture` |

### 規則 4.4: UX 定義與測試同步檢查

**在更新 UX 定義或測試時，必須確保兩者同步**：

#### 4.4.1: UX 定義更新時

**當更新 `docs/features/*.md` 中的 UX 定義時**：

- 必須同步更新對應的測試文件 `tests/ux/UX####.test.tsx`
- 確保測試描述包含更新後的觸發條件、操作步驟、預期結果
- 確保測試驗證了所有更新後的預期結果

#### 4.4.2: 測試更新時

**當更新 `tests/ux/UX####.test.tsx` 中的測試時**：

- 必須同步更新對應的 UX 定義 `docs/features/*.md`
- 確保 UX 定義反映測試的實際驗證內容
- 確保 UX 定義的預期結果與測試斷言一致

#### 4.4.3: 使用檢查工具驗證同步

**在完成更新後，必須使用檢查工具驗證**：

```bash
npm run tdd:check-ux-test
```

**檢查項目**：

- UX 定義是否存在對應的測試
- 測試描述是否包含 UX 定義的所有預期結果
- 測試是否驗證了所有操作步驟
- 測試觸發條件是否與 UX 定義一致

#### 4.4.4: 同步檢查清單

**在更新 UX 定義或測試時，確認**：

- [ ] UX 定義的觸發條件與測試的初始狀態一致
- [ ] UX 定義的操作步驟與測試的執行步驟一致
- [ ] UX 定義的預期結果與測試的斷言一致
- [ ] 測試描述包含完整的 UX 定義資訊
- [ ] 使用 `npm run tdd:check-ux-test` 驗證通過

## 何時載入此規則

此規則在以下情況自動載入：

- 編輯 `docs/` 目錄下的檔案
- 編輯 `ARCHITECTURE.md`
- 進行文檔更新相關的對話
- 執行文檔檢查相關的命令
